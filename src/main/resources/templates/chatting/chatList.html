<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- jQuery( JavaScript 라이브러리 ) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <title>Title</title>

    <link href="/css/chatting/chatList.css" rel="stylesheet">
    <script src="/js/chatting/chatList.js"></script>

</head>
<body>
    <h1 th:if="${session?.loginUser}">로그인됨 : [[${session.loginUser.userName}]]</h1>
    <input th:if="${session?.loginUser}" type="hidden" name="uid" class="userId" th:value="${session.loginUser?.uid}">
    <div style="height: 50px;"></div>
    <div class="container">
        <div class="row">
            <div class="col-4" style="background-color: gray;">
                <h2>임시 화면( 삭제 예정 )</h2>
                <h3>회원 추가</h3>
                <form action="/view/chatting/user" method="post">
                    <input type="text" name="userName"> <button type="submit">일반 회원</button>
                </form>
                <form action="/view/chatting/mentor" method="post">
                    <input type="text" name="userName"> <button type="submit">멘토</button>
                </form>
                <hr>
                <h2>유저 목록</h2>
                <div>이름 클릭하면 로그인</div>
                <table>
                    <tr>
                        <th>이름</th>
                        <th>역할</th>
                        <th>단톡방 개설</th>
                    </tr>
                    <tr th:each="user: ${userList}">
                        <td>
                            <button class="loginBtn" th:data-user-id="${user.uid}">[[${user.userName}]]</button>
                        </td>
                      
                        <td th:text="${user.role}"></td>
                        <td>
                            <div th:if="${user.role.name() == 'MENTOR'}">
                                <input type="text" th:class="'roomName-' + ${user.uid}" placeholder="단톡방 이름">
                                <select th:class="'userLimit-' + ${user.uid}">
                                    <option value="5">5</option>
                                    <option value="10">10</option>
                                    <option value="15">15</option>
                                </select>
                                <!-- <input type="text" th:class="'userLimit-' + ${user.uid}" placeholder="인원 제한"> -->
                                <button class="createRoom" th:data-user-id="${user.uid}">단톡방 생성</button>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>

            <div class="col-8" style="min-width: 860px;">
                <h2>SSE통신</h2>
                
                <h2>단톡방 목록</h2>
                <hr>
                <div id="chatRoomListBox">
                    <div class="row rowDiv" th:each="cardRow : ${#numbers.sequence(0, chatRoomList.size() - 1, 4)}">
                        <div class="col-3 roomUI" th:classappend="'room-' + ${chatRoom.id}"
                            th:each="chatRoom : ${chatRoomList.subList(cardRow, cardRow + 4 > chatRoomList.size() ? chatRoomList.size() : cardRow + 4)}">
                            <div class="card mb-2">
                                <div class="row">
                                    <div class="col-4">
                                        <img src="/img/chatting/undraw_profile.svg" style="width: 50px; height: 50px;">
                                    </div>
                                    <div class="col-8">
                                        <p>[[${chatRoom.mentor}]]</p>
                                    </div>
                                </div>
                                <h4>[[${chatRoom.roomName}]]</h4>
                                <div>생성된 시간 : [[${chatRoom.createdAt}]]</div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>인원 : 
                                        <span th:class="'roomUserCount-' + ${chatRoom.id}"
                                            >[[${chatRoom.userCount}]]</span>/<span>[[${chatRoom.userLimit}]] </span>
                                    </div>
                                    
                                    <form th:if="${session?.loginUser}"
                                        th:action="@{/api/chatting/participant/{roomId}/{loginId}(roomId=${chatRoom.id}, loginId=${session.loginUser?.uid})}"
                                        method="post">
                                        <button type="submit"> 단톡 참석 </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    

</body>
<script>


</script>
</html>